<!DOCTYPE html>
<!--
    So Simple Jekyll Theme 3.2.0
    Copyright 2013-2019 Michael Rose - mademistakes.com | @mmistakes
    Free for personal and commercial use under the MIT license
    https://github.com/mmistakes/so-simple-theme/blob/master/LICENSE
-->
<html lang="en-US" class="no-js">
  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  

  
    
    <!-- Begin Jekyll SEO tag v2.7.1 -->
<title>[프로젝트] Medium 클론 백엔드를 만들어보자 -7장 | json9512’s Blog</title>
<meta name="generator" content="Jekyll v4.2.0" />
<meta property="og:title" content="[프로젝트] Medium 클론 백엔드를 만들어보자 -7장" />
<meta name="author" content="json9512" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Medium 클론 백엔드를 설계부터 배포까지 기록하는 시리즈" />
<meta property="og:description" content="Medium 클론 백엔드를 설계부터 배포까지 기록하는 시리즈" />
<link rel="canonical" href="https://json9512.github.io/blog/%ED%94%84%EB%A1%9C%EC%A0%9D%ED%8A%B8-Medium-%ED%81%B4%EB%A1%A0-%EB%B0%B1%EC%97%94%EB%93%9C%EB%A5%BC-%EB%A7%8C%EB%93%A4%EC%96%B4%EB%B3%B4%EC%9E%90-7%EC%9E%A5/" />
<meta property="og:url" content="https://json9512.github.io/blog/%ED%94%84%EB%A1%9C%EC%A0%9D%ED%8A%B8-Medium-%ED%81%B4%EB%A1%A0-%EB%B0%B1%EC%97%94%EB%93%9C%EB%A5%BC-%EB%A7%8C%EB%93%A4%EC%96%B4%EB%B3%B4%EC%9E%90-7%EC%9E%A5/" />
<meta property="og:site_name" content="json9512’s Blog" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-01-08T00:00:00+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="[프로젝트] Medium 클론 백엔드를 만들어보자 -7장" />
<script type="application/ld+json">
{"@type":"BlogPosting","author":{"@type":"Person","name":"json9512"},"publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://json9512.github.io/blog/images/logo.png"},"name":"json9512"},"headline":"[프로젝트] Medium 클론 백엔드를 만들어보자 -7장","dateModified":"2021-01-08T00:00:00+00:00","datePublished":"2021-01-08T00:00:00+00:00","description":"Medium 클론 백엔드를 설계부터 배포까지 기록하는 시리즈","mainEntityOfPage":{"@type":"WebPage","@id":"https://json9512.github.io/blog/%ED%94%84%EB%A1%9C%EC%A0%9D%ED%8A%B8-Medium-%ED%81%B4%EB%A1%A0-%EB%B0%B1%EC%97%94%EB%93%9C%EB%A5%BC-%EB%A7%8C%EB%93%A4%EC%96%B4%EB%B3%B4%EC%9E%90-7%EC%9E%A5/"},"url":"https://json9512.github.io/blog/%ED%94%84%EB%A1%9C%EC%A0%9D%ED%8A%B8-Medium-%ED%81%B4%EB%A1%A0-%EB%B0%B1%EC%97%94%EB%93%9C%EB%A5%BC-%EB%A7%8C%EB%93%A4%EC%96%B4%EB%B3%B4%EC%9E%90-7%EC%9E%A5/","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->


  

  <script>
    /* Cut the mustard */
    if ( 'querySelector' in document && 'addEventListener' in window ) {
      document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + 'js';
    }
  </script>

  <link rel="stylesheet" href="/blog/assets/css/main.css">
  <link rel="stylesheet" href="/blog/assets/css/skins/dark.css">
  
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,400i,700,700i|Lora:400,400i,700,700i">
  <link rel="alternate" type="application/atom+xml" title="json9512&#39;s Blog" href="/blog/atom.xml">
<!-- start custom head snippets -->

<!-- insert favicons. use http://realfavicongenerator.net/ -->
<link rel="apple-touch-icon" sizes="180x180" href="https://json9512.github.io/blog/images/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://json9512.github.io/blog/images/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="https://json9512.github.io/blog/images/favicon-16x16.png">
<link rel="manifest" href="https://json9512.github.io/blog/images/site.webmanifest">
<link rel="shortcut icon" href="https://json9512.github.io/blog/images/favicon.ico">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="msapplication-config" content="https://json9512.github.io/blog/images/browserconfig.xml">
<meta name="theme-color" content="#ffffff">
<!-- end custom head snippets -->

</head>


  <body class="layout--post  프로젝트-medium-클론-백엔드를-만들어보자-7장">
    <nav class="skip-links">
  <h2 class="screen-reader-text">Skip links</h2>
  <ul>
    <li><a href="#primary-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    
  <div class="navigation-wrapper">
    <a href="#menu-toggle" id="menu-toggle">Menu</a>
    <nav id="primary-nav" class="site-nav animated drop">
      <ul><li><a href="/blog/about/">About</a></li><li><a href="/blog/posts/">Posts</a></li><li><a href="/blog/tags/">Tags</a></li><li><a href="/blog/search/">Search</a></li></ul>
    </nav>
  </div><!-- /.navigation-wrapper -->


    <header class="masthead">
  <div class="wrap">
    
      <a href="/blog/" class="site-logo" rel="home" title="json9512's Blog">
        <img src="/blog/images/logo.png" class="site-logo-img animated fadeInDown" alt="json9512's Blog">
      </a>
    
    
    
      
        <div class="site-title animated fadeIn"><a href="/blog/">json9512's Blog</a></div>
      
      <p class="site-description animated fadeIn" itemprop="description"></p>
    
  </div>
</header><!-- /.masthead -->


    <main id="main" class="main-content" aria-label="Content">
  <article class="h-entry">
    

    <div class="page-wrapper">
      <header class="page-header">
        
        
          <h1 id="page-title" class="page-title p-name">[프로젝트] Medium 클론 백엔드를 만들어보자 -7장
</h1>
        
      </header>

      <div class="page-sidebar">
        <div class="page-author h-card p-author"><img src="https://avatars3.githubusercontent.com/u/52622949?s=460&u=c44028732ef6df70300cae4bdd94bdaae4ef25b5&v=4" class="author-avatar u-photo" alt="json9512"><div class="author-info"><div class="author-name">
        <em>by</em> <span class="p-name">json9512</span>
      </div><ul class="author-links"><li class="author-link">
            <a class="u-url" rel="me" href="https://github.com/json9512"><i class="fab fa-github-square fa-lg" title="Github"></i></a>
          </li><li class="author-link">
            <a class="u-url" rel="me" href="https://www.linkedin.com/in/junghyun-son/"><i class="fab fa-linkedin fa-lg" title="LinkedIn"></i></a>
          </li><li class="author-link">
            <a class="u-url" rel="me" href="https://www.instagram.com/sonj1219/"><i class="fab fa-instagram fa-lg" title="Instagram"></i></a>
          </li></ul>

<span class="read-time">5 min read</span>

    <time class="page-date dt-published" datetime="2021-01-08T00:00:00+00:00"><a class="u-url" href="">January 8, 2021</a>
</time>

  </div>
</div>

        

        
  <h3 class="page-taxonomies-title">Tags</h3>
  
  <ul class="page-taxonomies"><li class="page-taxonomy"><a href="/blog/tags/#project" title="Pages tagged project" rel="tag">project</a></li>
  </ul>


      </div>

      <div class="page-content">
        <div class="e-content">
          <p><strong>목차</strong></p>
<ol>
  <li><a href="/blog/프로젝트-Medium-클론-백엔드를-만들어보자-1장/">Medium 클론 백엔드를 만들어보자 -1장</a></li>
  <li><a href="/blog/프로젝트-Medium-클론-백엔드를-만들어보자-2장/">Medium 클론 백엔드를 만들어보자 -2장</a></li>
  <li><a href="/blog/프로젝트-Medium-클론-백엔드를-만들어보자-3장/">Medium 클론 백엔드를 만들어보자 -3장</a></li>
  <li><a href="/blog/프로젝트-Medium-클론-백엔드를-만들어보자-4장/">Medium 클론 백엔드를 만들어보자 -4장</a></li>
  <li><a href="/blog/프로젝트-Medium-클론-백엔드를-만들어보자-5장/">Medium 클론 백엔드를 만들어보자 -5장</a></li>
  <li><a href="/blog/프로젝트-Medium-클론-백엔드를-만들어보자-6장/">Medium 클론 백엔드를 만들어보자 -6장</a></li>
  <li>Medium 클론 백엔드를 만들어보자 -7장</li>
  <li><a href="/blog/프로젝트-Medium-클론-백엔드를-만들어보자-8장/">Medium 클론 백엔드를 만들어보자 -8장</a></li>
  <li><a href="/blog/프로젝트-Medium-클론-백엔드를-만들어보자-9장/">Medium 클론 백엔드를 만들어보자 -9장</a></li>
</ol>

<h1 id="이전-포스트에서---">이전 포스트에서 . . .</h1>
<ul>
  <li>인증/인가 방식을 결정</li>
  <li>기본적인 개발 환경, 서버 구축, 테스트 코드 작성</li>
</ul>

<h1 id="이-포스트는---">이 포스트는 . . .</h1>
<ul>
  <li>Docker Image 화</li>
  <li>Github Actions로 테스트 자동화 및 Docker Image 자동화</li>
</ul>

<h1 id="docker-image화">Docker Image화</h1>
<p><a href="https://www.docker.com/">Docker</a> 는 쉽게 설명하면 PaaS이고 OS-level 가상화를 이용해 앱을 <code class="language-plaintext highlighter-rouge">container</code>로 패키지화 해준다.</p>

<p>Docker에 대해 설명하는 포스트는 추후에 작성하도록 하겠다.</p>

<p>Docker Image화는 가상화된 환경에 특정 앱을 저장시키고 행동양식을 설정해주는 것이다. Image는 Docker Container에 배포되게 되면 설정된 행동양식에 따라 일렬의 코드를 실행시킨다. 이론상으로는 아무 컴퓨터에서 Docker Image 만 Container로 띄우면 Image속에 저장된 Go server는 정상 작동된다. 또한 만든 Docker Image를 Docker Hub에 올릴 수 있다. (Docker Hub는 Github 같은 저장소다)</p>

<p>이 Go Server를 Docker Image로 만들려면 일단 Docker를 설치해야 한다.</p>

<p>Docker는 linux에 특화된 프로그램이어서 윈도우에서 설치하려면 구글의 힘이 필요할 수도 있다. 물론 요즘은 쉽게 사용할 수 있도록 잘 만들어 놓았으니, 알아서 Docker를 설치를 해보자.</p>

<ul>
  <li><a href="https://docs.docker.com/docker-for-windows/install/">공식 설치 가이드</a></li>
</ul>

<p>이 Go server를 이미지화 시키려면 일단 root 경로에 Dockerfile을 만들어야 한다. <code class="language-plaintext highlighter-rouge">docker build</code>라는 명령어를 사용을 할텐데 이 명령어는 기본적으로 <code class="language-plaintext highlighter-rouge">Dockerfile</code>을 찾는다.</p>

<p><code class="language-plaintext highlighter-rouge">docker-compose</code>도 있는데 이거는 복수의 Dockerfile을 이미지화 시켜 각 Container를 구동할 때 주로 사용된다.</p>

<p>아무튼, Dockerfile 속 코드는 다음과 같다.</p>

<div class="language-dockerfile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Source: Go blog https://blog.golang.org/docker</span>
<span class="c"># Source: https://medium.com/@monirz/golang-dependency-solution-with-go-module-and-docker-8967da6dd9f6</span>
<span class="c"># Start base Image</span>
<span class="k">FROM</span><span class="s"> golang</span>

<span class="c"># Setup Environment</span>
<span class="k">ENV</span><span class="s"> GO111MODULE=on</span>

<span class="k">WORKDIR</span><span class="s"> /app/server</span>
<span class="c"># Copy go mod and go sum</span>
<span class="k">COPY</span><span class="s"> go.mod .</span>
<span class="k">COPY</span><span class="s"> go.sum .</span>

<span class="c"># Install dependencies</span>
<span class="k">RUN </span>go mod download

<span class="c"># Copy rest of the file</span>
<span class="k">COPY</span><span class="s"> . .</span>

<span class="c"># Build the app in Docker</span>
<span class="k">RUN </span>go build

<span class="k">EXPOSE</span><span class="s"> 8080</span>

<span class="k">CMD</span><span class="s"> [ "./mediumclone-go" ]</span>
</code></pre></div></div>

<p>하나씩 설명해 보겠다</p>

<p><code class="language-plaintext highlighter-rouge">FROM golang</code> - Docker에서 만들어 놓은 <code class="language-plaintext highlighter-rouge">golang</code>이라는 이미지다. 이것을 기본으로 쓰겠다고 하는 것이다.</p>

<p><code class="language-plaintext highlighter-rouge">ENV GO111MODULE=on</code> - 환경변수 <code class="language-plaintext highlighter-rouge">GO111MODULE</code> 을 켜는 것이다. <code class="language-plaintext highlighter-rouge">GO111MODULE</code>이 뭔지 <a href="https://dev.to/maelvls/why-is-go111module-everywhere-and-everything-about-go-modules-24k">설명</a>을 간략히 하자면, 고의 <code class="language-plaintext highlighter-rouge">import</code> 방식을 변경해 주는 것이다. 또 다른 이유로는 <code class="language-plaintext highlighter-rouge">go get</code>을 할 때 패키지의 특정 버전을 가져올 수 있다.</p>

<p><code class="language-plaintext highlighter-rouge">WORKDIR /app/server</code> - 현재 폴더를 <code class="language-plaintext highlighter-rouge">/app/server</code>로 해준다</p>

<p><code class="language-plaintext highlighter-rouge">COPY go.mod .</code> - <code class="language-plaintext highlighter-rouge">go.mod</code> 파일을 현재 폴더 (도커 내)에 복사 해주는 것 <code class="language-plaintext highlighter-rouge">COPY go.sum</code>도 마찬가지</p>

<p><code class="language-plaintext highlighter-rouge">RUN go mod download</code> - 명령어 <code class="language-plaintext highlighter-rouge">go mod download</code>를 도커 내에서 실행 시킨다. <code class="language-plaintext highlighter-rouge">go.mod</code>에 적힌 모든 패키지를 다운받는다</p>

<p><code class="language-plaintext highlighter-rouge">COPY . .</code> - 현재 폴더 (컴퓨터)의 모든 파일/폴더를 현재 폴더 (도커)로 복사한다</p>

<p><code class="language-plaintext highlighter-rouge">RUN go build</code> - 명령어 <code class="language-plaintext highlighter-rouge">go build</code>를 도커 내에서 실행시킨다. <code class="language-plaintext highlighter-rouge">go build</code>는 <code class="language-plaintext highlighter-rouge">go.mod</code> 파일에 설정 된 <code class="language-plaintext highlighter-rouge">xxxx/mediumclone-go</code>에서 <code class="language-plaintext highlighter-rouge">mediumclone-go</code>라는 이름의 executable (실행 가능한) 파일을 만든다. (.exe 파일)</p>

<p><code class="language-plaintext highlighter-rouge">EXPOSE 8080</code> - 도커내 포트 8080을 외부에서 연결 할 수 있도록 연다</p>

<p><code class="language-plaintext highlighter-rouge">CMD [ "./mediumclone-go" ]</code> - 도커내 터미널에서 주어진 명령어를 실행한다. <code class="language-plaintext highlighter-rouge">./mediumclone-go</code>는 <code class="language-plaintext highlighter-rouge">go build</code> 로 만들어진 <code class="language-plaintext highlighter-rouge">mediumclone-go</code> 파일을 실행시킨다.</p>

<p>이렇게 <code class="language-plaintext highlighter-rouge">Dockerfile</code>을 간단히 만들어봤다. 현재는 환경변수도 없고 개인 정보도 없어서 간단하지만 추후에 데이터베이스를 연결하고 환경변수를 만들게되면 다 추가해줘야 한다.</p>

<p>이제 프로젝트의 root 경로에서 <code class="language-plaintext highlighter-rouge">docker build .</code>를 하게 되면 아래와 같이 실행이 되는 것을 볼 수 있다.</p>

<p><img src="/blog/images/dockerimage.png" class="align-center" alt="" /></p>

<p><code class="language-plaintext highlighter-rouge">docker images</code>를 실행하면 <code class="language-plaintext highlighter-rouge">&lt;none&gt;</code> 이지만 방금 만들어진 이미지를 볼 수 있다.</p>

<p><img src="/blog/images/dockerimage2.png" class="align-center" alt="" /></p>

<p><code class="language-plaintext highlighter-rouge">docker run  -p 6060:8080 --name goserver c5a8</code>로 방금 만든 이미지를 컨테이너에 실행해보자.</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">-p</code> - <code class="language-plaintext highlighter-rouge">--publish</code>의 약자다. 뒤에 오는 <code class="language-plaintext highlighter-rouge">6060:8080</code>은 포트 숫자고 <code class="language-plaintext highlighter-rouge">host:docker</code> 라고 보면 된다. 아까 <code class="language-plaintext highlighter-rouge">Dockerfile</code>에서 <code class="language-plaintext highlighter-rouge">8080</code>을 열었으니 그 <code class="language-plaintext highlighter-rouge">8080</code>에 내 컴퓨터 <code class="language-plaintext highlighter-rouge">6060</code>을 연결한다고 보면된다.</li>
  <li><code class="language-plaintext highlighter-rouge">--name</code> - 은 실행되는 컨테이너의 이름을 정해주는 것이다</li>
  <li><code class="language-plaintext highlighter-rouge">c5a8</code> - 아까 본 <code class="language-plaintext highlighter-rouge">&lt;none&gt;</code> 이미지의 Image ID 일부분이다.</li>
</ul>

<p><code class="language-plaintext highlighter-rouge">docker ps</code> 로 실행되고 있는 모든 컨테이너를 볼 수 있다.</p>

<p><img src="/blog/images/dockerimage3.png" class="align-center" alt="" /></p>

<p>잘 실행되고 있는 것을 볼 수 있다.</p>

<p>이제 크롬을 켜서 <code class="language-plaintext highlighter-rouge">localhost:6060/ping</code>으로 가면</p>

<p><img src="/blog/images/dockerrunning.png" class="align-center" alt="" /></p>

<p>Go server가 잘 돌아가고 있는 것을 볼 수 있다.</p>

<p>됐다. 고 서버를 도커 이미지화 하는 방법은 알았다. 이제 이걸 자동화 해보자.</p>

<h4 id="여담">여담</h4>

<ul>
  <li><code class="language-plaintext highlighter-rouge">docker rm &lt;container id&gt;</code> - 로 실행되고 있는 container를 없앨 수 있다. 경우에 따라 <code class="language-plaintext highlighter-rouge">--force</code>를 해야 할 수 있다</li>
  <li><code class="language-plaintext highlighter-rouge">docker rmi &lt;image id&gt;</code> - 로 저장된 도커 이미지를 지울 수 있다. 마찬가지로 <code class="language-plaintext highlighter-rouge">--force</code>를 써야 할 수도 있다</li>
</ul>

<h1 id="github-actions">Github Actions</h1>

<p>Github Actions는 사실 CI/CD 용으로 만들어진 툴이 아니다. 개발자들의 요청으로 Github Actions로 CI/CD가 가능하게 되었다.</p>

<p>Github Actions는 <code class="language-plaintext highlighter-rouge">특정 event 발생 -&gt; 특정 작업 수행</code>의 구조를 가지고 있다.</p>

<p>이것을 사용해서 개발자가 repo 에 코드를 <code class="language-plaintext highlighter-rouge">push</code> 하면 Github Actions가 알아서 코드를 <code class="language-plaintext highlighter-rouge">test</code> 할 수 있게 할 수 있다. 이게 곧 CI에 기본이 되는 flow다.</p>

<p>이 <code class="language-plaintext highlighter-rouge">mediumclone-go</code>에는 자동화 해야 할 부분이 다음과 같다.</p>

<ol>
  <li><code class="language-plaintext highlighter-rouge">main, develop</code> branch에 코드 <code class="language-plaintext highlighter-rouge">push, pull_request</code> 시 테스트 자동화</li>
  <li><code class="language-plaintext highlighter-rouge">main</code> branch에 코드 <code class="language-plaintext highlighter-rouge">push, pull_request</code> 시 Docker image 생성 및 Docker hub으로 푸시</li>
  <li>배포 (어디로 배포할지 정해야 한다)</li>
</ol>

<p>일단 처음 1. 2.번만 시도하도록 하자.</p>

<p><a href="https://docs.github.com/en/free-pro-team@latest/actions/learn-github-actions/introduction-to-github-actions">공식 가이드</a> 를 보면서 <code class="language-plaintext highlighter-rouge">workflow</code>를 만들어 보도록 하겠다.</p>

<p>제일 처음해야 할 것은 프로젝트의 root 경로에 <code class="language-plaintext highlighter-rouge">.github/workflows</code> 폴더를 생성해야 하는 것이다. 그 후 <code class="language-plaintext highlighter-rouge">&lt;이름&gt;.yml</code> 파일을 만들고 특정 workflow를 이 파일안에 작성하면 된다.</p>

<p>아래는 <code class="language-plaintext highlighter-rouge">test-server.yml</code>의 코드다.</p>
<div class="language-yml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">name</span><span class="pi">:</span> <span class="s">test-server</span>
<span class="na">on</span><span class="pi">:</span>
  <span class="na">push</span><span class="pi">:</span>
    <span class="na">branches</span><span class="pi">:</span> <span class="pi">[</span><span class="s1">'</span><span class="s">main'</span><span class="pi">,</span> <span class="s1">'</span><span class="s">develop'</span><span class="pi">]</span>
  <span class="na">pull_request</span><span class="pi">:</span>
    <span class="na">branches</span><span class="pi">:</span> <span class="pi">[</span><span class="s1">'</span><span class="s">main'</span><span class="pi">,</span> <span class="s1">'</span><span class="s">develop'</span><span class="pi">]</span>

<span class="na">jobs</span><span class="pi">:</span>
  <span class="na">build</span><span class="pi">:</span>
    <span class="na">strategy</span><span class="pi">:</span>
      <span class="na">matrix</span><span class="pi">:</span>
        <span class="na">os</span><span class="pi">:</span> <span class="pi">[</span><span class="s1">'</span><span class="s">ubuntu-latest'</span><span class="pi">,</span> <span class="s1">'</span><span class="s">macos-latest'</span><span class="pi">,</span> <span class="s1">'</span><span class="s">windows-latest'</span><span class="pi">]</span>
    <span class="na">runs-on</span><span class="pi">:</span> <span class="s">$</span>

    <span class="na">steps</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Testing on ($)</span>
      <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/checkout@v2</span>
    
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Setup Go</span>
      <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/setup-go@v2</span>
      <span class="na">with</span><span class="pi">:</span>
        <span class="na">go-version</span><span class="pi">:</span> <span class="m">1.15</span>
    
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Build</span>
      <span class="na">run</span><span class="pi">:</span> <span class="s">go build -v ./...</span>
    
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Test</span>
      <span class="na">run</span><span class="pi">:</span> <span class="s">go test -v ./...</span>
</code></pre></div></div>

<p>간단히 설명하면 <code class="language-plaintext highlighter-rouge">main, develop</code> branch에 <code class="language-plaintext highlighter-rouge">push, pull_request</code>가 생기면 <code class="language-plaintext highlighter-rouge">macos, ubuntu, windows</code>에서 <code class="language-plaintext highlighter-rouge">mediumclone-go</code>를 테스트하는 workflow다.</p>

<p>이제 이 코드를 <code class="language-plaintext highlighter-rouge">commit</code> 하고 <code class="language-plaintext highlighter-rouge">push</code>를 하자.</p>

<p>이후 repository에 Actions 탭에 가보면</p>

<p><img src="/blog/images/githubactions.png" class="align-center" alt="" /></p>

<p>이런 결과가 나와야 한다.</p>

<p>내친김에 <code class="language-plaintext highlighter-rouge">Docker</code> 이미지화 및 Docker Hub에 배포도 자동화 하자.</p>

<p>기존 파일에 이어서 작성하면 전체는 아래와 같다. 파일명을 <code class="language-plaintext highlighter-rouge">ci-docker-cd.yml</code>로 바꿨다.</p>
<div class="language-yml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">name</span><span class="pi">:</span> <span class="s">CI/Docker/CD</span>
<span class="na">on</span><span class="pi">:</span>
  <span class="na">push</span><span class="pi">:</span>
    <span class="na">branches</span><span class="pi">:</span> <span class="pi">[</span><span class="s1">'</span><span class="s">main'</span><span class="pi">,</span> <span class="s1">'</span><span class="s">develop'</span><span class="pi">]</span>
  <span class="na">pull_request</span><span class="pi">:</span>
    <span class="na">branches</span><span class="pi">:</span> <span class="pi">[</span><span class="s1">'</span><span class="s">main'</span><span class="pi">,</span> <span class="s1">'</span><span class="s">develop'</span><span class="pi">]</span>

<span class="na">jobs</span><span class="pi">:</span>
  <span class="na">build-and-test</span><span class="pi">:</span>
    <span class="na">strategy</span><span class="pi">:</span>
      <span class="na">matrix</span><span class="pi">:</span>
        <span class="na">os</span><span class="pi">:</span> <span class="pi">[</span><span class="s1">'</span><span class="s">ubuntu-latest'</span><span class="pi">,</span> <span class="s1">'</span><span class="s">macos-latest'</span><span class="pi">,</span> <span class="s1">'</span><span class="s">windows-latest'</span><span class="pi">]</span>
    <span class="na">runs-on</span><span class="pi">:</span> <span class="s">${지우기{ matrix.os }}</span>

    <span class="na">steps</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Testing on (${지우기{ matrix.os }})</span>
      <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/checkout@v2</span>
    
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Setup Go</span>
      <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/setup-go@v2</span>
      <span class="na">with</span><span class="pi">:</span>
        <span class="na">go-version</span><span class="pi">:</span> <span class="m">1.15</span>
    
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Build</span>
      <span class="na">run</span><span class="pi">:</span> <span class="s">go build -v ./...</span>
    
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Test</span>
      <span class="na">run</span><span class="pi">:</span> <span class="s">go test -v ./...</span>

  <span class="na">push-docker-image</span><span class="pi">:</span>
    <span class="c1"># run when build is successful</span>
    <span class="na">needs</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">build-and-test</span><span class="pi">]</span>
    <span class="na">runs-on</span><span class="pi">:</span> <span class="pi">[</span><span class="s1">'</span><span class="s">ubuntu-latest'</span><span class="pi">]</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">Push Docker image to Hub</span>
    <span class="na">steps</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Checkout</span>
      <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/checkout@v2</span>

    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Set up Docker Buildx</span>
      <span class="na">uses</span><span class="pi">:</span> <span class="s">docker/setup-buildx-action@v1</span>
      <span class="na">with</span><span class="pi">:</span>
        <span class="na">driver</span><span class="pi">:</span> <span class="s">docker</span>

    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Login to Docker</span>
      <span class="na">uses</span><span class="pi">:</span> <span class="s">docker/login-action@v1</span>
      <span class="na">with</span><span class="pi">:</span>
        <span class="na">username</span><span class="pi">:</span> <span class="s">${지우기{ secrets.DOCKER_HUB_USERNAME }}</span>
        <span class="na">password</span><span class="pi">:</span> <span class="s">${지우기{ secrets.DOCKER_HUB_PASSWORD }}</span>
    
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Build and push</span>
      <span class="na">id</span><span class="pi">:</span> <span class="s">docker_build</span>
      <span class="na">uses</span><span class="pi">:</span> <span class="s">docker/build-push-action@v2</span>
      <span class="na">with</span><span class="pi">:</span>
        <span class="na">context</span><span class="pi">:</span> <span class="s">./</span>
        <span class="na">file</span><span class="pi">:</span> <span class="s">./Dockerfile</span>
        <span class="na">load</span><span class="pi">:</span> <span class="no">true</span>
        <span class="na">tags</span><span class="pi">:</span> <span class="s">json9512/mediumclone-go:latest</span> <span class="c1"># docker repo</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Push</span>
      <span class="na">run</span><span class="pi">:</span> <span class="s">docker push json9512/mediumclone-go:latest</span>
    
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Image digest</span>
      <span class="na">run</span><span class="pi">:</span> <span class="s">echo ${지우기{ steps.docker_build.outputs.digest }}</span>
</code></pre></div></div>
<p>살펴보면 <code class="language-plaintext highlighter-rouge">${지우기{ secrets.XXXX }}</code> 형식이 보일것이다. (<code class="language-plaintext highlighter-rouge">지우기</code> 는 지워주자) 이 <code class="language-plaintext highlighter-rouge">secrets</code>는 Github repository내에 Setting에서 설정해 줄 수 있다.</p>

<p>물론 지금 만든 <code class="language-plaintext highlighter-rouge">Dockerfile</code> 이나 <code class="language-plaintext highlighter-rouge">ci-docker-cd.yml</code>은 추후에 여러가지가 더해지고 없어지고 하면서 더 복잡해질 것이다.</p>

<p>하지만 미리 뼈대를 잡아놓으면 나중에 변경을 할 때 더 쉽다.</p>

<h1 id="마무리---">마무리 . . .</h1>
<p>정리를 하자면</p>
<ul>
  <li>Docker Image화를 위한 <code class="language-plaintext highlighter-rouge">Dockerfile</code>을 만들었고</li>
  <li>테스트/Docker image를 Hub에 push하는 Github Actions workflow를 만들었다.</li>
</ul>

<p><a href="/blog/프로젝트-Medium-클론-백엔드를-만들어보자-8장/">다음 포스트</a>에서는 어떤 방식으로 서버를 배포할 것인지를 정하자.</p>

        </div>

        
          <div class="page-share">
  <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fjson9512.github.io%2Fblog%2F%25ED%2594%2584%25EB%25A1%259C%25EC%25A0%259D%25ED%258A%25B8-Medium-%25ED%2581%25B4%25EB%25A1%25A0-%25EB%25B0%25B1%25EC%2597%2594%25EB%2593%259C%25EB%25A5%25BC-%25EB%25A7%258C%25EB%2593%25A4%25EC%2596%25B4%25EB%25B3%25B4%25EC%259E%2590-7%25EC%259E%25A5%2F" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" class="btn btn--facebook btn--small"><i class="fab fa-fw fa-facebook" aria-hidden="true"></i> <span>Share</span></a>
  <a href="https://twitter.com/intent/tweet?text=%5B%ED%94%84%EB%A1%9C%EC%A0%9D%ED%8A%B8%5D+Medium+%ED%81%B4%EB%A1%A0+%EB%B0%B1%EC%97%94%EB%93%9C%EB%A5%BC+%EB%A7%8C%EB%93%A4%EC%96%B4%EB%B3%B4%EC%9E%90+-7%EC%9E%A5%20https%3A%2F%2Fjson9512.github.io%2Fblog%2F%25ED%2594%2584%25EB%25A1%259C%25EC%25A0%259D%25ED%258A%25B8-Medium-%25ED%2581%25B4%25EB%25A1%25A0-%25EB%25B0%25B1%25EC%2597%2594%25EB%2593%259C%25EB%25A5%25BC-%25EB%25A7%258C%25EB%2593%25A4%25EC%2596%25B4%25EB%25B3%25B4%25EC%259E%2590-7%25EC%259E%25A5%2F" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" class="btn btn--twitter btn--small"><i class="fab fa-fw fa-twitter" aria-hidden="true"></i> <span>Tweet</span></a>
  <a href="https://www.linkedin.com/shareArticle?mini=true&url=https%3A%2F%2Fjson9512.github.io%2Fblog%2F%25ED%2594%2584%25EB%25A1%259C%25EC%25A0%259D%25ED%258A%25B8-Medium-%25ED%2581%25B4%25EB%25A1%25A0-%25EB%25B0%25B1%25EC%2597%2594%25EB%2593%259C%25EB%25A5%25BC-%25EB%25A7%258C%25EB%2593%25A4%25EC%2596%25B4%25EB%25B3%25B4%25EC%259E%2590-7%25EC%259E%25A5%2F" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" class="btn btn--linkedin btn--small"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i> <span>LinkedIn</span></a>
  <a href="https://reddit.com/submit?title=%5B%ED%94%84%EB%A1%9C%EC%A0%9D%ED%8A%B8%5D+Medium+%ED%81%B4%EB%A1%A0+%EB%B0%B1%EC%97%94%EB%93%9C%EB%A5%BC+%EB%A7%8C%EB%93%A4%EC%96%B4%EB%B3%B4%EC%9E%90+-7%EC%9E%A5&url=https%3A%2F%2Fjson9512.github.io%2Fblog%2F%25ED%2594%2584%25EB%25A1%259C%25EC%25A0%259D%25ED%258A%25B8-Medium-%25ED%2581%25B4%25EB%25A1%25A0-%25EB%25B0%25B1%25EC%2597%2594%25EB%2593%259C%25EB%25A5%25BC-%25EB%25A7%258C%25EB%2593%25A4%25EC%2596%25B4%25EB%25B3%25B4%25EC%259E%2590-7%25EC%259E%25A5%2F" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" class="btn btn--reddit btn--small"><i class="fab fa-fw fa-reddit" aria-hidden="true"></i> <span>Reddit</span></a>
</div>

        

        
          
  <div class="page-comments">
    <div id="disqus_thread"></div>
    <script>
      var disqus_config = function () {
        this.page.url = 'https://json9512.github.io/blog/%ED%94%84%EB%A1%9C%EC%A0%9D%ED%8A%B8-Medium-%ED%81%B4%EB%A1%A0-%EB%B0%B1%EC%97%94%EB%93%9C%EB%A5%BC-%EB%A7%8C%EB%93%A4%EC%96%B4%EB%B3%B4%EC%9E%90-7%EC%9E%A5/';
        this.page.identifier = 'https://json9512.github.io/blog/%ED%94%84%EB%A1%9C%EC%A0%9D%ED%8A%B8-Medium-%ED%81%B4%EB%A1%A0-%EB%B0%B1%EC%97%94%EB%93%9C%EB%A5%BC-%EB%A7%8C%EB%93%A4%EC%96%B4%EB%B3%B4%EC%9E%90-7%EC%9E%A5/';
      };

      (function() {
        var d = document, s = d.createElement('script');
        s.src = 'https://json9512-blog.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
      })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
  </div>


        

        <nav class="page-pagination" role="navigation">
  
    <a class="page-previous" href="/blog/%ED%94%84%EB%A1%9C%EC%A0%9D%ED%8A%B8-Medium-%ED%81%B4%EB%A1%A0-%EB%B0%B1%EC%97%94%EB%93%9C%EB%A5%BC-%EB%A7%8C%EB%93%A4%EC%96%B4%EB%B3%B4%EC%9E%90-6%EC%9E%A5/">
      <h4 class="page-pagination-label">Previous</h4>
      <span class="page-pagination-title">
        <i class="fas fa-arrow-left"></i> [프로젝트] Medium 클론 백엔드를 만들어보자 -6장

      </span>
    </a>
  

  
    <a class="page-next" href="/blog/CS-%EA%B8%B0%EC%B4%88-%EB%B9%84%ED%8A%B8-%EC%97%B0%EC%82%B0/">
      <h4 class="page-pagination-label">Next</h4>
      <span class="page-pagination-title">
        [CS 기초] 비트 연산
 <i class="fas fa-arrow-right"></i>
      </span>
    </a>
  
</nav>

      </div>
    </div>
  </article>
</main>


    <footer id="footer" class="site-footer">
  <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
<div class="social-icons"><a class="social-icon" href="https://github.com/json9512"><i class="fab fa-github-square fa-2x" title="Github"></i></a><a class="social-icon" href="https://www.linkedin.com/in/junghyun-son/"><i class="fab fa-linkedin fa-2x" title="LinkedIn"></i></a><a class="social-icon" href="https://www.instagram.com/sonj1219/"><i class="fab fa-instagram fa-2x" title="Instagram"></i></a><a class="social-icon" href="mailto:json9512@gmail.com"><i class="fab fa-google fa-2x" title="Gmail"></i></a></div><div class="copyright">
    
      <p>&copy; 2021 json9512's Blog. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://github.com/mmistakes/so-simple-theme" rel="nofollow">So Simple</a>.</p>
    
  </div>
</footer>

    <script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
  <script src="/blog/assets/js/main.min.js"></script>
  <script src="https://use.fontawesome.com/releases/v5.0.12/js/all.js"></script>


<!-- MathJax -->

<script>
// http://docs.mathjax.org/en/latest/upgrading/v2.html
MathJax = {
  tex: {
      tags: "ams"    // eq numbering options: none, ams, all
  },
  options: {
    renderActions: {
      // for mathjax 3, handle <script "math/tex"> blocks inserted by kramdown
      find: [10, function (doc) {
        for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
          const display = !!node.type.match(/; *mode=display/);
          const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
          const text = document.createTextNode('');
          node.parentNode.replaceChild(text, node);
          math.start = {node: text, delim: '', n: 0};
          math.end = {node: text, delim: '', n: 0};
          doc.math.push(math);
        }
      }, '']
    }
  }
}
</script>

<script type="text/javascript" id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js"></script>

  </body>

</html>
